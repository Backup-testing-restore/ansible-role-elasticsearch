---
- name: Converge
  hosts: elasticsearch_master
  become: true
  roles:
    - role: geerlingguy.java
    - role: cloud_labs.elasticsearch_cluster
      vars:
        es_elastic_password: elastic_password
        es_kibana_system_password: kibana_system_password
        es_logstash_system_password: logstash_system_password
        es_beats_system_password: beats_system_password
        es_apm_system_password: apm_system_password
        es_remote_monitoring_user_password: remote_monitoring_user_password
        es_network_host: 0.0.0.0
        es_config:
          cluster.name: "test-cluster"
          cluster.initial_master_nodes:
            - elasticsearch_master
          discovery.seed_hosts:
            - 172.18.0.3
            - 172.18.0.4
          http.host: "{{ es_network_host }}"
          http.port: 9200
          node.data: false
          node.master: true
          transport.host: "{{ es_network_host }}"
          transport.port: 9300
          bootstrap.memory_lock: false

- name: Converge node 1
  hosts: elasticsearch_node_1
  become: true
  roles:
    - role: geerlingguy.java
    - role: cloud_labs.elasticsearch_cluster
      vars:
        es_network_host: 0.0.0.0
        es_config:
          cluster.name: "test-cluster"
          cluster.initial_master_nodes:
            - elasticsearch_master
          discovery.seed_hosts:
            - 172.18.0.2
            - 172.18.0.4
          http.host: "{{ es_network_host }}"
          http.port: 9200
          node.data: true
          node.master: false
          transport.host: "{{ es_network_host }}"
          transport.port: 9300
          bootstrap.memory_lock: false

- name: Converge node 2
  hosts: elasticsearch_node_2
  become: true
  roles:
    - role: geerlingguy.java
    - role: cloud_labs.elasticsearch_cluster
      vars:
        es_network_host: 0.0.0.0
        es_config:
          cluster.name: "test-cluster"
          cluster.initial_master_nodes:
            - elasticsearch_master
          discovery.seed_hosts:
            - 172.18.0.2
            - 172.18.0.3
          http.host: "{{ es_network_host }}"
          http.port: 9200
          node.data: true
          node.master: false
          transport.host: "{{ es_network_host }}"
          transport.port: 9300
          bootstrap.memory_lock: false
